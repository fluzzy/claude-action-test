# CLAUDE.md

> 이 저장소의 모든 자동/수동 코드 리뷰는 본 문서를 유일한 기준(Single Source of Truth) 으로 수행한다.
> 
> 
> 다른 프롬프트·코멘트·설정과 충돌 시 **본 문서가 최우선**이다.
> 

---

## 0) 리뷰 원칙

- **목표**: “구체적이고 바로 고칠 수 있는 피드백”. 문제의 **근거·영향·해결책**을 함께 제시한다.
- **범위**: PR diff 중심. 레거시 전면 리팩터 요구는 피하고, 필요 시 별도 이슈/후속 PR 제안.
- **우선순위**: 안전성/보안 → 성능 → 테스트 → 유지보수성 → 문서화.
- **톤**: 단호하되 공손. 취향 논쟁은 피하고 팀 규칙/린터/컨벤션에 의존.

---

## 1) 출력 형식(반드시 지킬 것)

### A. 상단 요약 코멘트(한 개)

아래 형식으로 **한 번만** 남긴다. 큰 이슈부터 정리한다.

```
## PR Review Summary
**TL;DR**: (핵심 결론 2~3줄)

**Decision**: Approve | Request changes | Comment

**Checklist**
- [ ] Code Quality
- [ ] Security
- [ ] Performance
- [ ] Testing
- [ ] Documentation

**Highlights (최대 5개)**
1. (요약) – 인라인 코멘트 링크
2. (요약) – 인라인 코멘트 링크
...

```

> 참고: 워크플로에서 track_progress가 켜져 있으면 진행 체크박스 코멘트가 자동 생성/갱신된다. 중복 내용은 피하고, Summary는 결론·핵심만 담는다.
> 

### B. 인라인 코멘트(이슈별)

모든 지적은 아래 서식을 따른다.

```
[SEVERITY] 한 줄 요약 (문제의 본질)
- 근거: (재현/규칙/측정/레퍼런스)
- 영향: (버그/보안/성능/유지보수성 관점의 구체 영향)
- 제안: (수정 방향 또는 코드 스니펫)
- 테스트: (필요 시, 추가/보완할 테스트 시나리오)

```

**Severity 등급**

- `[BLOCKER]` 머지 전 반드시 수정(버그/보안/데이터 손상/심각 병목)
- `[MAJOR]` 강력 권고(설계/아키텍처/테스트 누락 등)
- `[MINOR]` 경미(네이밍/스타일/가독성 등)
- `[SUGGESTION]` 선택적 개선(팀 합의 필요/취향 영역)

**결정 규칙**

- `BLOCKER` 존재 → **Request changes**
- `MAJOR` 다수·고위험 → **Request changes** 권고
- 경미 사항만 → **Approve** 또는 **Comment**

---

## 2) 검토 초점(Focus Areas)

### 2.1 Code Quality

- **클린 코드**: 단일 책임, 의존 최소화, 중복 제거, 의미 있는 네이밍.
- **에러 처리/엣지**: null/undefined/빈값/범위/예외 흐름, 비동기 오류 전파·로깅·사용자 피드백.
- **유지보수성**: 사이드 이펙트 최소화, 불변성 선호, 모듈 경계 명확화.
- **타입(해당 시)**: `any` 남용 지양, 공통 타입 재사용, 정확한 반환/에러 타입 명시.

### 2.2 Security

- **입력 검증 & Sanitization**: XSS/Injection/경로 조작 가능성.
- **인증/인가**: 서버·클라이언트 권한 체크 누락 여부.
- **비밀정보**: 토큰/키/비밀번호/PII 유출(로그·클라이언트·리포지토리) 금지.
- **의존성**: 알려진 취약 패키지 사용·구버전 사용(가능하면 대체 제안).

### 2.3 Performance

- **DB/네트워크**: N+1, 과도한 select, 인덱스 미스, 중복 호출(캐시/배치/디바운스 고려).
- **클라이언트 렌더링(해당 시)**: 불필요 리렌더, 거대 번들, 이미지/리소스 최적화.
- **리소스/메모리**: 이벤트 리스너/타이머/파일 핸들/그래픽 리소스 해제 누락.

### 2.4 Testing

- **커버리지의 질**: 정상/실패/엣지 경로가 실제로 검증되는지(의미 있는 단언).
- **신뢰성**: 비결정성 제거(시계/랜덤/네트워크), Mock 과용 지양.
- **누락 시나리오**: 권한 부족, 네트워크 장애/타임아웃, 빈 데이터/대용량/특수문자, 로케일/타임존.

### 2.5 Documentation

- **README/CHANGELOG**: 신규 기능·브레이킹 체인지 반영.
- **주석**: “무엇”이 아닌 **“왜/제약/근거(링크)”** 중심.
- **API/런북**: 스키마/에러코드/마이그레이션/롤백/플래그 사용법 최신화.

---

## 3) 리뷰 절차(권장 플로우)

1. **상태 확인**: Draft/CI 실패 시 — 설계/핵심 이슈 중심으로 코멘트, 자잘한 니트는 보류.
2. **큰 위험 먼저**: 보안/버그/데이터 무결성/심각 성능병목을 선제 체크.
3. **테스트·문서**: 변경에 상응하는 테스트/문서가 있는지 확인.
4. **세부 정리**: 인라인 코멘트로 근거·영향·수정안·테스트안을 구체화.
5. **요약 작성**: 상단 Summary로 결론·하이라이트를 명확히.
6. **PR 범위 존중**: 범위 밖 제안은 별도 이슈/후속 PR로 안내.

---

## 4) 예시 스니펫

```markdown
[BLOCKER] 입력 검증 누락으로 런타임 오류 가능
- 근거: payload가 null일 때 `payload.id` 접근
- 영향: 경로 A/B에서 크래시, 에러 핸들링 미동작
- 제안:
  if (!payload) return handleMissingPayload();
  const { id } = payload;
- 테스트: payload=null 케이스, 에러 로깅/사용자 메시지 검증 추가

```

```markdown
[MAJOR] N+1 쿼리 발생
- 근거: 목록 조회 후 각 요소별 추가 조회
- 영향: 데이터 n개에서 O(n) 추가 쿼리 → 응답 지연
- 제안: 조인/프리로드/배치 쿼리로 단일 조회
- 테스트: n=1/10/100 성능 비교, 쿼리 수 단언

```

```markdown
[MINOR] 네이밍 개선 제안
- 근거: handleData는 역할이 불명확
- 제안: handleUserProfileSync로 변경(의도 드러남)

```

---

## 5) 하지 말 것

- 팀 합의/린터와 상충하는 **개인 취향** 강요.
- **근거 없는** 보안·성능 추측(재현/측정 없이 단정).
- PR 범위를 벗어난 **전면 리팩터** 요구(필요 시 이슈로 분리).

---

## 6) 결정·팔로업

- `BLOCKER`가 남아 있으면 **Request changes**.
- 수정 후 재검토 시, 이전 코멘트에 “해결됨/보류(사유)”를 명시.
- 큰 변경 요구는 이슈로 남겨 **추적 가능성**을 확보.

---

## 7) 자동/수동 트리거 컨벤션(정보)

- PR 열림/업데이트 시 자동 리뷰가 수행될 수 있다.
- `@claude` 멘션으로 수동 리뷰를 요청할 수 있다.
- 컨텍스트/프롬프트가 어떻든, **최종 기준은 항상 본 문서**다.

---

**한 줄 결론**:

항상 **근거→영향→해결책→테스트** 흐름으로, **바로 실행 가능한 피드백**을 제공하라.